services:
  ai_ji_ke:
    # 优先使用已存在的镜像，不存在则自动构建
    image: ai_ji_ke:latest
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ai_ji_ke
    ports:
      # 将容器的 8986 端口映射到主机的 8986 端口
      # 你可以修改左边的端口号来使用其他端口，例如 "9000:8986"
      - "8986:8986"
    volumes:
      # 课程下载目录持久化
      # 课程文件将保存在主机的 ./org_courses 目录
      - ./org_courses:/app/org_courses
      
      # 持久化配置文件（用户数据、设置等）
      - ./data:/root/.local/share/geekbang-crawler
    environment:
      # 设置时区
      - TZ=Asia/Shanghai
      # Python 输出不缓冲
      - PYTHONUNBUFFERED=1
    restart: unless-stopped
    # 资源限制（可选）
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '2.0'
    #       memory: 2G
    #     reservations:
    #       cpus: '1.0'
      #   memory: 512M

# 定义持久化卷
volumes:
  ai_ji_ke_data:
    driver: local
